---
title: "Lab 4 - Gráficos, hipótesis"
subtitle: "Métodos Cuantitativos"
author: "Carlos Eduardo Molina Berumen"
institute: "El Colegio de México"
lang: es
date: today
date-format: long
echo: TRUE
message: FALSE
warning: FALSE
format:
  beamer:
    theme: AnnArbor
    colortheme: default
    header-includes: |
      % --- Definir colores Colmex ---
      \definecolor{colmexred}{HTML}{7A0019}
      \definecolor{colmexgold}{HTML}{C5A46D}
      \definecolor{colmexgray}{HTML}{2E2E2E}
      \definecolor{colmexlight}{HTML}{F2F2F2}

      % --- Sobrescribir paletas del theme ---
      \setbeamercolor{palette primary}{fg=white,bg=colmexred}
      \setbeamercolor{palette secondary}{fg=white,bg=colmexgray}
      \setbeamercolor{palette tertiary}{fg=white,bg=colmexgold}
      \setbeamercolor{palette quaternary}{fg=white,bg=colmexlight}

      \setbeamercolor{frametitle}{fg=white,bg=colmexred}
      \setbeamercolor{title}{fg=colmexgold}
      \setbeamercolor{structure}{fg=colmexred}
      \setbeamercolor{block title}{fg=white,bg=colmexred}
      \setbeamercolor{block body}{fg=colmexgray,bg=colmexlight}
      \setbeamercolor{item}{fg=colmexgold}

      % --- Colores de la portada ---
      \setbeamercolor{titlelike}{fg=white, bg=colmexred}
      \setbeamercolor{title page}{fg=colmexred,bg=white}
      \setbeamercolor{title page title}{fg=colmexred}
      \setbeamercolor{subtitle}{fg=colmexgold}
      \setbeamercolor{author}{fg=colmexgray}
      \setbeamercolor{institute}{fg=colmexgray}
      \setbeamercolor{date}{fg=colmexgray}

      % --- Logo en la portada ---
      \titlegraphic{\includegraphics[width=3cm]{Colmex_logo.jpeg}}

      % --- Footer personalizado con franjas redistribuidas ---
      \makeatletter
      \defbeamertemplate*{footline}{custom in head/foot}{
        \leavevmode
        \hbox{%
          \begin{beamercolorbox}[wd=.45\paperwidth,ht=2.5ex,dp=1.5ex,left]{author in head/foot}%
            \usebeamerfont{author in head/foot}\insertshortauthor\expandafter\beamer@ifempty\expandafter{\beamer@shortinstitute}{}{~~(\insertshortinstitute)}
          \end{beamercolorbox}%
          \begin{beamercolorbox}[wd=.25\paperwidth,ht=2.5ex,dp=1.5ex,center]{title in head/foot}%
            \usebeamerfont{title in head/foot}\insertshorttitle
          \end{beamercolorbox}%
          \begin{beamercolorbox}[wd=.3\paperwidth,ht=2.5ex,dp=1.5ex,right]{date in head/foot}%
            \usebeamerfont{date in head/foot}\insertshortdate{}\hspace*{2em}\insertframenumber{} / \inserttotalframenumber\hspace*{2ex}%
          \end{beamercolorbox}%
        }%
        \vskip0pt
      }
      \makeatother
---

# Recapitulación

Hemos visto: - Comandos básicos de R - Cómo explorar bases de datos - Cómo sacar estadísticos descriptivos univariadoa - Tipos de variables

# Objetivos de hoy:

-   Entender ggplot y cómo hacer buenas gráficas
-   Cómo hacer pruebas de hipótesis

# ggplot2

```{r}
#install.packages("ggplot2")
library(ggplot2)
```

-   Con ggplot creamos gráficos empleando una gramática de gráficos que crea objetos de visualización compuestos por capas
-   Esta gramática de gráficos se basa en tres componentes: datos, sistema de coordenadas y marcas visuales (geoms)

## ¿Por qué usar ggplot2 en lugar de r base para nuestros gráficos?

```{r}
library(readr)
library(dplyr)

data <- read_csv("Estados.csv")
data2020 <- data %>% 
  filter(Año == "2020")

```

------------------------------------------------------------------------

```{r, out.width="60%"}
hist(data2020$Edad_mediana, 
     xlab = "Edad",
     ylab = "Frecuencia")
```

------------------------------------------------------------------------

# Con ggplot2

```{r, echo = F, out.width="80%"}
#install.packages("ggplot2")
library(ggplot2)
ggplot(data2020, aes(x = Edad_mediana)) +
  geom_histogram( fill = "darkblue") +
  labs(
    x = "Mediana de la edad por cada estado",
    y = "Frecuencia",
    title = "Distribución de las edades medianas en México",
    subtitle = "Histograma con datos desagregados por estado ",
    caption = "Fuente: Censo poblacional INEGI 2020"
) +
  theme(
    plot.title=element_text(size=14, face="bold"),
    plot.subtitle=element_text(size=8),
    plot.caption=element_text(size=6),
    axis.title=element_text(size=8),
    axis.text=element_text(size=8)
)
```

------------------------------------------------------------------------

```{r, eval = F}

ggplot(df, aes(x, y, other aesthetics))

```

-   Data frame (df)
-   Conjunto de definiciones estéticas (e.g. definición de ejes)
-   Agregamos capas al gráfico con +

------------------------------------------------------------------------

# Ejemplo: ¿Cómo crear un histograma en ggplot?

¿Cómo se distribuye el porcentaje de población afromexicana en México?

```{r, out.width="80%"}
plot <- ggplot(data2020, aes(x = Pob_afro_share)) +
  geom_histogram()
```

------------------------------------------------------------------------

```{r, out.width="80%"}
print(plot)
```

------------------------------------------------------------------------

Si quieren ver todos los colores que tiene R, busquen "R colors cheatsheet". Cambiemos color, contorno y ancho de nuestras barras.

```{r, out.width="80%"}
plot_a <- ggplot(data2020, aes(x = Pob_afro_share)) +
  geom_histogram( fill = "firebrick4", color = "indianred4",
                  binwidth=0.4) 
```

------------------------------------------------------------------------

```{r, out.width="80%"}
print(plot_a)
```

------------------------------------------------------------------------

Recordemos: Nuestra gráfica debe comunicarnos toda la información necesaria sin remitirnos a nada más.

Una buena gráfica lleva:

-   Título (y un subtítulo opcional)
-   Descripción de los ejes
-   La fuente de tus datos

------------------------------------------------------------------------

```{r, out.width="80%"}
plot_b <- ggplot(data2020, aes(x = Pob_afro_share)) +
  geom_histogram( fill = "firebrick4", color = "indianred4",
                  binwidth=0.4) +
  labs(
    x = "Porcentaje de población afromexicana",
    y = "Frecuencia",
    title = "Distribución del porcentaje de población afromexicana",
    subtitle = "Histograma con datos desagregados por estado ",
    caption = "Fuente: Censo poblacional INEGI 2020"
)
```

------------------------------------------------------------------------

```{r, out.width="80%"}
print(plot_b)
```

------------------------------------------------------------------------

Cambiemos el estilo de nuestras labs

```{r, out.width="80%"}
plot_c <- ggplot(data2020, aes(x = Pob_afro_share)) +
  geom_histogram( fill = "firebrick4", color = "indianred4",
                  binwidth=0.4) +
  labs(
    x = "Porcentaje de población afromexicana",
    y = "Frecuencia",
    title = "Distribución del porcentaje de población afromexicana",
    subtitle = "Histograma con datos desagregados por estado ",
    caption = "Fuente: Censo poblacional INEGI 2020"
) +
  theme(
    plot.title=element_text(size=14, face="bold"),
    plot.subtitle=element_text(size=8),
    plot.caption=element_text(size=6),
    axis.title=element_text(size=8),
    axis.text=element_text(size=8)
)
```


---


```{r, out.width="80%"}

print(plot_c)

```


---


# Parte 2: Prueba de hipótesis

Objetivo: inferir sobre una población a partir de una muestra.

Conceptos centrales: hipótesis nula ($H_0$) e hipótesis alternativa ($H_1$).

------------------------------------------------------------------------

**1. Planteamiento de $H_0$ y $H_1$**

El primer paso es definir claramente qué queremos probar.

Hipótesis nula (H): no existe diferencia en la población católica entre 2010 y 2020.

Hipótesis alternativa (H₁): sí existe diferencia, es decir, la población católica cambió entre esos años.

------------------------------------------------------------------------

**2. Selección del nivel de significancia $\alpha$**

Dado que estamos comparando el mismo número de observaciones, ocuparemos un t-test.

Comúnmente se usa

$\alpha$=0.05

Representa la probabilidad de rechazar H₀ cuando es verdadera (error tipo I).

------------------------------------------------------------------------

**3. Cálculo del p-value**

R lo calcula automáticamente con t.test(..., paired = TRUE)

El p-value indica la probabilidad de observar una diferencia igual o más extrema que la actual si $H_0$ fuera cierta.

------------------------------------------------------------------------

**4. Decisión: rechazar o no rechazar H₀**

Si p-value \< $\alpha$ (0.05): rechazar H₀ → hay evidencia estadística de que la población católica cambió entre 2010 y 2020.

Si p-value ≥ $\alpha$: no se rechaza $H_0$ → no hay evidencia suficiente para afirmar que cambió.

------------------------------------------------------------------------

#Población católica entre 2010 y 2020

¿ha cambiado la población católica en México entre 2010 y 2020?

¿Cuáles serían $H_0$ y $H_1$?

------------------------------------------------------------------------

**Hipótesis**

$H_0$: católicos2020 = católicos 2010

$H_1$: católicos2020 $\neq$católicos 2010

------------------------------------------------------------------------

Creemos nuestros datos y hágamos la prueba. ¿Qué concluimos?

```{r}

data2010 <- data %>% 
  filter(Año == "2010")

t.test(data2020$Pob_catolica, data2010$Pob_catolica, 
       alternative = "two.sided")

```
